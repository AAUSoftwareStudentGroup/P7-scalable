<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Dating</title>

        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="/style/style.css" rel="stylesheet">

        <script src="main.js"></script>
    </head>
    <body>
        <script>
            var storageKey = "session";
            var flags = localStorage.getItem(storageKey);
            var app = Elm.Main.init({flags: flags});

            app.ports.storeLocally.subscribe(function(val) {
                if (val === null) {
                    localStorage.removeItem(storageKey);
                } else {
                    localStorage.setItem(storageKey, JSON.stringify(val));
                }

                // Report that the new session was stored successfully.
                setTimeout(function() {
                    app.ports.onStoreChange.send(localStorage.getItem(storageKey));
                }, 0);
            });


            // Whenever localStorage changes in another tab, report it if necessary.
            window.addEventListener("storage", function(event) {
                console.log(event);
                if (event.storageArea === localStorage) {
                    console.log('Calling onStoreChange!');
                    app.ports.onStoreChange.send(event.newValue);
                }
            }, false);
        </script>
    </body>
</html>
