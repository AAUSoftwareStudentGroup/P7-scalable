<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Dating</title>

        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="/style/style.css" rel="stylesheet">

        <script
                src="https://code.jquery.com/jquery-3.3.1.min.js"
                integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
                crossorigin="anonymous">
        </script>
        <script src="main.js"></script>
    </head>
    <body>
        <script>
            var storageKey = "session";
            var flags = localStorage.getItem(storageKey);
            var app = Elm.Main.init({flags: flags});

            app.ports.storeLocally.subscribe(function(val) {
                if (val === null) {
                    localStorage.removeItem(storageKey);
                } else {
                    localStorage.setItem(storageKey, JSON.stringify(val));
                }

                // Report that the new session was stored successfully.
                setTimeout(function() {
                    app.ports.onStoreChange.send(localStorage.getItem(storageKey));
                }, 0);
            });

            // Whenever localStorage changes in another tab, report it if necessary.
            window.addEventListener("storage", function(event) {
                console.log(event);
                if (event.storageArea === localStorage) {
                    console.log('Calling onStoreChange!');
                    app.ports.onStoreChange.send(event.newValue);
                }
            }, false);


            // Handle file
            app.ports.fileSelected.subscribe(function (id) {
              var node = document.getElementById(id);
              if (node === null) {
                return;
              }
              console.log(id);
              // If your file upload field allows multiple files, you might
              // want to consider turning this into a `for` loop.
              var file = node.files[0];
              var reader = new FileReader();

              // FileReader API is event based. Once a file is selected
              // it fires events. We hook into the `onload` event for our reader.
              reader.onload = (function(event) {
                // The event carries the `target`. The `target` is the file
                // that was selected. The result is base64 encoded contents of the file.
                var base64encoded = event.target.result;
                // We build up the `ImagePortData` object here that will be passed to our Elm
                // runtime through the `fileContentRead` subscription.
                var portData = {
                  contents: base64encoded,
                  filename: file.name
                };

                // We call the `fileContentRead` port with the file data
                // which will be sent to our Elm runtime via Subscriptions.
                app.ports.fileContentRead.send(portData);
              });

              // Connect our FileReader with the file that was selected in our `input` node.
              reader.readAsDataURL(file);
});
        </script>

        <script>
            $('body').on('click', 'header nav', () => $('header nav').toggleClass('closed'));
        </script>
    </body>
</html>
